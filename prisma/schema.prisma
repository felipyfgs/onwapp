generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum SessionStatus {
  disconnected
  connecting
  connected
}

enum WAPrivacyValue {
  all
  contacts
  contact_blacklist
  none
}

enum WAPrivacyOnlineValue {
  all
  match_last_seen
}

enum WAPrivacyCallValue {
  all
  known
}

enum WAPrivacyMessagesValue {
  all
  contacts
}

enum WAReadReceiptsValue {
  all
  none
}

enum WAPrivacyGroupAddValue {
  all
  contacts
  contact_blacklist
}

model Session {
  id          String           @id @default(uuid())
  name        String
  status      SessionStatus    @default(disconnected)
  qrCode      String?
  phoneNumber String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  authState   AuthState[]
  webhooks    Webhook[]
  contacts    Contact[]
  chats       Chat[]
  messages    Message[]
  settings    SessionSettings?

  @@map("Session")
}

model AuthState {
  id        String   @id @default(uuid())
  sessionId String
  keyType   String   // Tipos: creds, pre-key, session, app-state-sync-key, app-state-sync-version, sender-key, sender-key-memory
  keyId     String   // Identificador Ãºnico para cada key dentro do tipo
  keyData   Json     // Dados da chave em formato JSON (com BufferJSON para buffers)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, keyType, keyId])
  @@map("AuthState")
}

model Webhook {
  id        String   @id @default(cuid())
  sessionId String   @unique
  enabled   Boolean  @default(true)
  url       String
  events    String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("Webhook")
}

enum MessageStatus {
  pending
  sent
  delivered
  read
  failed
}

model Contact {
  id             String   @id @default(uuid())
  sessionId      String
  remoteJid      String
  name           String?
  profilePicUrl  String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  session        Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, remoteJid])
  @@index([sessionId, name])
  @@map("Contact")
}

model Chat {
  id                    String    @id @default(uuid())
  sessionId             String
  remoteJid             String
  name                  String?
  unreadCount           Int       @default(0)
  lastMessageTimestamp  BigInt?
  archived              Boolean   @default(false)
  pinned                Boolean   @default(false)
  muted                 Boolean   @default(false)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  session               Session   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  messages              Message[]

  @@unique([sessionId, remoteJid])
  @@index([sessionId, lastMessageTimestamp])
  @@map("Chat")
}

model Message {
  id            String        @id @default(uuid())
  sessionId     String
  chatId        String
  remoteJid     String
  messageId     String
  fromMe        Boolean
  senderJid     String?
  senderName    String?
  timestamp     BigInt
  messageType   String
  content       Json
  status        MessageStatus @default(pending)
  isDeleted     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  session       Session       @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  chat          Chat          @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@unique([sessionId, messageId])
  @@index([sessionId, chatId, timestamp])
  @@map("Message")
}

model SessionSettings {
  id              String                  @id @default(uuid())
  sessionId       String                  @unique
  rejectCall      Boolean                 @default(false)
  groupsIgnore    Boolean                 @default(false)
  alwaysOnline    Boolean                 @default(false)
  readMessages    Boolean                 @default(false)
  readStatus      Boolean                 @default(false)
  syncFullHistory Boolean                 @default(true)
  profilePicture  WAPrivacyValue?
  status          WAPrivacyValue?
  lastSeen        WAPrivacyValue?
  online          WAPrivacyOnlineValue?
  call            WAPrivacyCallValue?
  messages        WAPrivacyMessagesValue?
  readReceipts    WAReadReceiptsValue?
  groupsAdd       WAPrivacyGroupAddValue?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  session         Session                 @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("SessionSettings")
}
